# 数据库连接池
1. 黑话:
- 容器 -> 集合
- 规范 -> 接口
- 框架 -> 反射+xml/Annotation

2. 数据库连接池
- 其实就是一个容器(集合)，存放数据库连接的容器。
- 当系统初始化好后，容器被创建，容器中会申请一些连接对象，当用户来访问数据库时，从容器中获取连接对象，用户访问完之后，会将连接对象归还给容器。

3. 实现
    1. 标准接口：DataSource   javax.sql包下的
        - 获取连接：getConnection()
        - 归还连接：Connection.close()
    2. 一般我们不去实现它，有数据库厂商来实现
        1. C3P0：数据库连接池技术
		2. Druid：数据库连接池实现技术，由阿里巴巴提供的

4. 最近学的规范与实现
    |接口|实现|
    |----|----|
    |JDBC接口|驱动|
    |DataSource|连接池|

UML图学一下

5. Druid
    1. 导入JAR包
        1. druid-0.1.10.jar,
            - 如果带source,java文件,源码
            - 不带source,编译后的class文件用来导入
        2. commons-logging-1.2.jar,APACH公司的日志包

6. 读入配置文件
- 硬编码
```java
    public void Test1() throws SQLException {
        DruidDataSource dataSource = new DruidDataSource();
        //硬编码不可取,应该从配置文件读取
        dataSource.setDriverClassName("com.mysql.cj.jdbc.Driver");//包名+类名:全限类名 Driver是类名
        dataSource.setUrl("jdbc:mysql://localhost:3306/myschool?serverTimezone=GMT&useSSL=false");
        dataSource.setUsername("root");
        dataSource.setPassword("admin");

        dataSource.setInitialSize(3);
        dataSource.setMaxActive(6);
        dataSource.setMaxWait(-1);//永久等待

        Connection con1 = dataSource.getConnection();
```

- 建议使用配置文件
```java
public class DruidUtils {

    private static DataSource datasource;

    //初始化DruidDataSource
    static {
        Properties prop = new Properties();
        InputStream is = DruidUtils.class.getClassLoader().getResourceAsStream("druid.properties"); //放在src下面
        try {
            prop.load(is);  //如果读不出来的话可以试试Rebuild Project
            datasource = (DruidDataSource) DruidDataSourceFactory.createDataSource(prop);//一个能读取文件的工厂方法
        } catch (Exception e) {
            e.printStackTrace();
        }
    }

    //获取连接
    public static Connection getConn() throws SQLException {
        return datasource.getConnection();
    }
    //关闭连接等等
    //...
}
```
7. 使用
- Ctrl + R 全部替换
```java
//只改DAO层的就行
//1.获取
conn = DruidUtils.getConn();
//2.关闭
DruidUtils.close(conn, pstm, rs);
```